/* ===== Design tokens ===== */
:root{
  --bg:#F6F7FB; --panel:#FFFFFF; --ink:#0F172A; --muted:#6B7280; --line:#E5E7EB;
  --shadow:0 10px 30px rgba(17,24,39,.08);
  --radius:14px;
  --font:"Inter","SF Pro Text",-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;

  --accent-1:#5CAAFF; --accent-2:#306BFF;

  --a4-w:210mm; --a4-h:297mm;
  --pad-t:12mm; --pad-r:18mm; --pad-b:14mm; --pad-l:18mm;

  --logo-h:42mm; --logo-nudge-y:-2mm; --title-nudge-y:-2mm;

  --preview-zoom:1;
}

/* ===== Base ===== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:var(--font); color:var(--ink); background:var(--bg);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
.hidden{display:none!important}

/* Links */
.link{
  background:transparent;border:none;padding:0;margin:0 0 0 6px;
  color:#2563eb;font-weight:600;cursor:pointer;line-height:1;
}
.link:hover{text-decoration:underline}

/* ===== Topbar ===== */
.topbar{
  position:sticky; top:0; z-index:50;
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 18px; background:rgba(255,255,255,.85);
  border-bottom:1px solid var(--line); backdrop-filter:blur(6px);
}
.brand{display:flex;align-items:center;gap:10px}
.brand-mark{width:18px;height:18px}
.title{font-weight:600;letter-spacing:.2px}
.top-actions{display:flex;gap:10px}

/* ===== Buttons ===== */
.btn{
  display:inline-flex;align-items:center;gap:10px;
  padding:10px 14px;border:1px solid #D1D5DB;border-radius:12px;
  background:#fff;color:#111827;font-weight:600;letter-spacing:.2px;
  cursor:pointer;transition:transform .08s,box-shadow .2s,background .15s;
  line-height:1;
}
.btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(17,24,39,.10);background:#F9FAFB}
.btn-ghost{background:#F3F4F6;border-style:dashed}
.btn-ico{width:18px;height:18px}
.btn-primary{
  border:none;color:#fff;background:linear-gradient(180deg,var(--accent-1),var(--accent-2));
  box-shadow:0 10px 20px rgba(48,107,255,.25)
}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 14px 26px rgba(48,107,255,.30)}
.btn-primary:active{transform:translateY(0) scale(.99)}
.btn[disabled]{opacity:.55;cursor:not-allowed;box-shadow:none;transform:none}

/* ===== Layout ===== */
.layout{
  display:grid; align-items:start; gap:36px; padding:22px;
  grid-template-columns: clamp(720px, 52vw, 900px) 1fr;
}
.panel{ min-width:720px; position:relative; z-index:2; }
.preview{position:relative; z-index:1}

/* ===== Cards ===== */
.card{
  background:var(--panel); border:1px solid var(--line);
  border-radius:var(--radius); box-shadow:var(--shadow);
  padding:28px; margin-bottom: 14px;
}
.card-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.card-t{display:flex;align-items:center;gap:10px;font-weight:600}
.card-t .ico{width:18px;height:18px;color:#111827}
.card-divider{border:0;border-top:1px solid var(--line);margin:18px 0 12px}

/* ===== Fields & labels ===== */
.field{ margin-bottom:14px;  position:relative; display:block; padding-top:2px; padding-bottom:2px; isolation:isolate; }
.field input,.field textarea,.field select{
  width:100%; font-size:14px; line-height:1.35; height:56px;
  padding:24px 14px 12px 14px; border:1px solid #D1D5DB; background:#fff; color:#111827;
  border-radius:12px; outline:none; transition:border-color .15s, box-shadow .15s, background .15s;
}
.field textarea{ min-height:110px; height:auto; padding-top:26px; resize:vertical }
.field label{
  position:absolute; left:12px; top:50%; transform:translateY(-50%);
  padding:0 8px; background:transparent; color:#6B7280; pointer-events:none;
  transition:all .15s ease; font-size:12.5px; z-index:2; border-radius:8px;
}
.field label::after{ display:none; }

.field input::placeholder,.field textarea::placeholder{color:transparent}
.field input:focus,.field textarea:focus,.field select:focus{border-color:#8CB3FF;box-shadow:0 0 0 3px rgba(48,107,255,.15)}

.field input:focus+label,.field textarea:focus+label,
.field input:not(:placeholder-shown)+label,.field textarea:not(:placeholder-shown)+label{
  top:-10px !important; transform:none !important; color:#374151; font-size:12px; box-shadow:none;
}
.field input:focus+label::after,.field textarea:focus+label::after,
.field input:not(:placeholder-shown)+label::after,.field textarea:not(:placeholder-shown)+label::after{display:none!important}

/* Statisk label för datum/select */
.field--static label{ position:absolute; left:10px; top:-10px; transform:none; padding:0 6px; font-size:12px; color:#374151; background:transparent; border-radius:8px; box-shadow:none; z-index:5; }
.field--static label::after{ display:none; }
.field--static input,.field--static select{ padding-top:18px; }

/* Fel */
.field.error input{border-color:#ef4444;box-shadow:0 0 0 3px rgba(239,68,68,.15)}

/* ===== Grid helpers ===== */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; column-gap:32px; row-gap: 56px; }
.grid-3{ display:grid; grid-template-columns:repeat(3,1fr); column-gap:32px; row-gap: 56px; }

/* ===== Importer ===== */
.importer{display:grid; grid-template-columns:1fr auto; gap:12px; margin-bottom:10px}

/* ===== Produkt-rader (FORM) ===== */
.items-head{
  display:grid;
  grid-template-columns: 56px 0.9fr 1.7fr 0.95fr 0.9fr 0.7fr 32px;
  gap:10px; padding:8px 10px;
  border:1px dashed #D1D5DB; border-radius:12px;
  margin-bottom: 14px; color:#6B7280; font-size:12px; background:#FAFAFB;
}
#items .row{
  display:grid;
  grid-template-columns: 56px 0.9fr 1.7fr 0.95fr 0.9fr 0.7fr 32px;
  gap:10px; align-items:center; margin-bottom: 14px; max-width:100%;
}
#items .row input{
  height:42px; background:#fff; border:1px solid #D1D5DB;
  border-radius:12px; padding:8px 10px; color:#111827; min-width:0;
}
#items .row button{height:42px; min-width:32px}

/* ===== Sticky totals ===== */
.stickybar{
  position:sticky; bottom:12px; margin-top:30px;
  background:#fff; border:1px solid var(--line); border-radius:var(--radius);
  padding:16px 18px; display:grid; grid-template-columns:1fr auto; align-items:center; gap:16px;
  box-shadow:var(--shadow);
}
.totals-mini{display:flex;gap:22px;align-items:center}
.totals-mini>div{display:grid;gap:4px}
.totals-mini span{color:#6B7280;font-size:12px}
.totals-mini strong{font-weight:600}

.attest-wrap{display:flex;align-items:center}
.attest-label{display:flex;gap:10px;align-items:flex-start}
.attest-label input{margin-top:2px}
.attest-label span{font-size:12.8px;line-height:1.45;color:#111827}

/* ===== Preview ===== */
.preview-toolbar{
  display:flex;align-items:center;justify-content:space-between;
  background:#fff; border:1px solid var(--line); border-radius:var(--radius);
  padding:10px 12px; margin-bottom: 14px; box-shadow:var(--shadow);
}
.muted{color:#6B7280;font-size:12px}
.seg{display:flex;background:#F3F4F6;border:1px solid #E5E7EB;border-radius:10px;overflow:hidden}
.seg-btn{background:transparent;border:none;color:#111827;padding:8px 10px;cursor:pointer;font-weight:600}
.seg-btn.is-active,.seg-btn:hover{background:#E5E7EB}

.paper-host{ overflow:auto; border-radius:var(--radius); padding:16px; background:#F1F5F9; border:1px solid var(--line); box-shadow:var(--shadow); min-height:80vh; }
.paper-frame{transform:scale(var(--preview-zoom));transform-origin:top center}
.paper{
  position:relative; width:var(--a4-w); height:var(--a4-h); margin:0 auto;
  background:#fff; color:#000; padding:var(--pad-t) var(--pad-r) var(--pad-b) var(--pad-l);
  box-shadow:0 10px 30px rgba(0,0,0,.08); border-radius:12px;
}

/* ===== Fakturainnehåll (PDF) ===== */
.header{display:flex;justify-content:space-between;align-items:center;gap:16px}
.header h1{font-size:30px;font-weight:700;margin:0 0 24px 0;letter-spacing:.2px;transform:translateY(var(--title-nudge-y))}
.logo-img{height:var(--logo-h);object-fit:contain;display:block;transform:translateY(var(--logo-nudge-y))}
.addresses{display:grid;grid-template-columns:1.1fr 1.1fr 1.2fr;gap:28px;margin-top:8px}
.addr h3{font-size:13px;font-weight:700;margin:0 0 8px 0}
.addr p{margin:0;font-size:13px;line-height:1.5;white-space:pre-line}
.facts{font-size:13px;line-height:1.7}
.facts .row{display:flex;justify-content:space-between;gap:16px}
.facts .key{text-align:left;white-space:nowrap}
.facts .val{text-align:right;white-space:nowrap;font-weight:500}
.sida{text-align:right;font-size:12px;font-weight:700;margin:4px 0 6px 0}

.rule{border:none;border-top:2px solid #000;margin:24px 0 18px 0}
.muted-rule{border:none;border-top:1px solid #000;margin:20px 0 16px 0}
.hello{font-size:14px;margin:0 0 10px 0}
.intro{font-size:14px;margin:0 0 6px 0}

/* Tabell i fakturan */
.tbl{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px}
.tbl thead th{text-align:left;font-weight:700;padding:10px 8px 8px;border-bottom:1px solid #000;white-space:nowrap}
.tbl tbody td{vertical-align:top;padding:10px 8px;border-bottom:1px solid #e5e7eb;line-height:1.5}
.col-antal{width:6%}.col-artnr{width:21%;overflow-wrap:break-word}
.col-produkt{width:36%;line-height:1.6}
.col-netto{width:18%;text-align:right;white-space:nowrap}
.col-total{width:13%;text-align:right;white-space:nowrap}
.col-moms{width:6%;text-align:right;white-space:nowrap}

/* Totalt */
.totals{width:360px;margin-left:auto;margin-top:18px;font-size:14px}
.totals .row{display:grid;grid-template-columns:1fr auto;padding:6px 0}
.totals .label{text-align:right;padding-right:12px}.totals .value{text-align:right}
.totals .grand{font-weight:700}

/* Juridisk fot i PDF */
.legal{
  position:absolute; left:var(--pad-l); right:var(--pad-r); bottom:10mm;
  font-size:10px; line-height:1.3; color:#000; text-align:left; opacity:.95;
  border-top:1px solid #000; padding-top:6px;
}

/* Footer i UI */
.footnote{padding:14px 18px;color:var(--muted);font-size:12px;text-align:center;border-top:1px solid var(--line);margin-top:16px}

/* ===== Modal ===== */
.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:100; }
.modal.is-open{ display:flex; }
.modal-backdrop{ position:absolute; inset:0; background:rgba(15,23,42,.45); backdrop-filter:blur(4px); }
.modal-card{
  position:relative; z-index:1; width:min(720px, 92vw); max-height:min(84vh, 900px);
  background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow);
  display:flex; flex-direction:column;
}
.modal-h{ display:flex; align-items:center; justify-content:space-between; padding:18px 20px; border-bottom:1px solid var(--line); }
.modal-h h3{ margin:0; font-size:18px; font-weight:700; }
.modal-x{ border:none; background:#F3F4F6; border-radius:10px; padding:8px 10px; cursor:pointer; }
.modal-body{ padding:18px 20px; overflow:auto; font-size:14px; line-height:1.6; }
.modal-body p{ margin:0 0 12px; }
.modal-f{ display:flex; gap:10px; justify-content:flex-end; padding:16px 20px; border-top:1px solid var(--line); }

/* ===== UI-WATERMARK ===== */
.wm-preview{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  pointer-events:none; user-select:none;
  font-size:64mm; font-weight:800; letter-spacing:2mm; text-transform:uppercase;
  color:#000; opacity:0.06; transform:rotate(-18deg); mix-blend-mode:multiply;
}

/* Responsive */
@media (max-width:1200px){
  .layout{grid-template-columns:1fr}
  .panel{min-width:0}
  .preview{order:-1}
}

/* Print */
@media print{
  body{background:#fff}
  .topbar,.layout > .panel,.preview-toolbar,.footnote{display:none!important}
  .paper-host{padding:0;background:#fff;border:none;box-shadow:none}
  .paper-frame{transform:none!important}
  .paper{box-shadow:none;border-radius:0;margin:0 auto}
  @page{size:A4;margin:0}
}

/* Behållna overrides från tidigare diffar */
.field textarea + label::after{ display:none !important; }
.field input + label::after{ display:none !important; }
